<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       ">

    <bean id="filterChainProxy"
          class="org.acegisecurity.util.FilterChainProxy">
        <property name="filterInvocationDefinitionSource">
            <value>
                CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
                PATTERN_TYPE_APACHE_ANT
                /**=httpSessionContextIntegrationFilter,authenticationSystemLogoutFilter,authenticationSystemSocket,securityContextHolderAwareRequestFilter,exceptionTranslationFilter,filterInvocationInterceptor
            </value>
        </property>
    </bean>

    <bean id="httpSessionContextIntegrationFilter"
          class="org.acegisecurity.context.HttpSessionContextIntegrationFilter"/>

    <bean id="authenticationSystemLogoutFilter"
          class="edu.northwestern.bioinformatics.studycalendar.security.AuthenticationSystemLogoutFilter">
        <property name="authenticationSystemConfiguration" ref="authenticationSystemConfiguration"/>
    </bean>

    <bean id="defaultLogoutFilter"
          class="org.acegisecurity.ui.logout.LogoutFilter">
        <constructor-arg value="/pages/dashboard"/>
        <!-- URL redirected to after logout -->
        <constructor-arg>
            <list>
                <bean class="org.acegisecurity.ui.logout.SecurityContextLogoutHandler"/>
            </list>
        </constructor-arg>
    </bean>

    <bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"/>

    <bean id="pscAuthenticationProvider"
         class="edu.northwestern.bioinformatics.studycalendar.security.plugin.PSCAuthenticationProvider">
        <property name="studyCalendarAuthenticationManager" ref="pscAuthenticationManager"/>
        <property name="userDetailsService" ref="pscUserDetailsService"/>
        <property name="userCache" ref="userCache"/>
    </bean>

    <bean class="edu.northwestern.bioinformatics.studycalendar.security.plugin.StudyCalendarAuthenticationManager" id="pscAuthenticationManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="pscUserDetailsService"
          class="edu.northwestern.bioinformatics.studycalendar.security.PscUserDetailsService">
        <property name="userService" ref="userService"/>
    </bean>

    <bean id="userCache"
          class="org.acegisecurity.providers.dao.cache.EhCacheBasedUserCache">
        <property name="cache">
            <bean class="org.springframework.cache.ehcache.EhCacheFactoryBean">
                <property name="cacheManager" ref="cacheManager"/>
                <property name="cacheName" value="userCache"/>
            </bean>
        </property>
    </bean>

    <bean id="securityContextHolderAwareRequestFilter"
          class="org.acegisecurity.wrapper.SecurityContextHolderAwareRequestFilter"/>

    <bean id="anonymousProcessingFilter"
          class="org.acegisecurity.providers.anonymous.AnonymousProcessingFilter">
        <property name="key" value="PSC_ANON"/>
        <property name="userAttribute" value="anonymousUser,ROLE_ANONYMOUS"/>
    </bean>

    <bean id="exceptionTranslationFilter"
          class="org.acegisecurity.ui.ExceptionTranslationFilter">
        <property name="authenticationEntryPoint"
                  ref="authenticationSystemSocket"/>
    </bean>

    <bean id="filterInvocationInterceptor"
          class="org.acegisecurity.intercept.web.FilterSecurityInterceptor">
        <property name="authenticationManager" ref="authenticationSystemSocket"/>
        <property name="accessDecisionManager">
            <ref local="accessDecisionManager"/>
        </property>
        <!--
            objectDefinitionSource is overridden by ControllerSecureUrlCreator
            (ref'd in spring-servlet.xml). This value stays because Acegi complains if
            there's no value when the bean is initialized.
        -->
        <property name="objectDefinitionSource">
            <value>
                CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
                PATTERN_TYPE_APACHE_ANT
            </value>
        </property>
    </bean>

    <bean id="accessDecisionManager" class="org.acegisecurity.vote.AffirmativeBased">
        <property name="decisionVoters">
            <list>
                <bean class="gov.nih.nci.security.acegi.csm.vote.AuthorizationSwitchVoter">
                    <property name="authorizationSwitch"
                              ref="authorizationSwitch"/>
                </bean>
                <bean class="org.acegisecurity.vote.RoleVoter">
                    <property name="rolePrefix">
                        <value></value>
                    </property>
                </bean>
            </list>
        </property>
    </bean>
</beans>