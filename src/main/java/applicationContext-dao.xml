<?xml version="1.0" encoding="UTF-8"?>
<!--
    This applicationContext contains the definition of the DAOs
-->

<beans
    xmlns="http://www.springframework.org/schema/beans"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd"
    >

    <!-- HIBERNATE CONFIGURATION -->

    <bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean" autowire="byName">
        <property name="mappingLocations">
            <list>
                <value>classpath:edu/northwestern/bioinformatics/studycalendar/domain/hibernate/typedefs.hbm.xml</value>
                <!--<value>classpath:edu/northwestern/bioinformatics/studycalendar/domain/hibernate/overrides.xml</value>-->
            </list>
        </property>
        <property name="namingStrategy">
            <bean class="edu.northwestern.bioinformatics.studycalendar.utils.hibernate.StudyCalendarNamingStrategy"/>
        </property>
        <property name="annotatedClasses">
            <list>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.StudySegment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Duration</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Period</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Study</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Activity</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ActivityType</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.PlannedActivity</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Site</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Source</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.StudySite</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Subject</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.StudySubjectAssignment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.PlannedCalendar</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Epoch</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ScheduledCalendar</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ScheduledStudySegment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ScheduledActivity</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Scheduled</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Occurred</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Canceled</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Conditional</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Missed</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.NotApplicable</value>
                <value>gov.nih.nci.cabig.ctms.tools.configuration.ConfigurationEntry</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.auditing.LoginAudit</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.reporting.ReportRow</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.AdverseEvent</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.AdverseEventNotification</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.MonthDayHoliday</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.DayOfTheWeek</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.RelativeRecurringHoliday</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.User</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.UserRole</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Population</value>

                <!-- Amendments & customizations -->
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Amendment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Change</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Add</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Reorder</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PropertyChange</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Remove</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Delta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PlannedCalendarDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.EpochDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.StudySegmentDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PeriodDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PlannedActivityDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.AmendmentApproval</value>
            </list>
        </property>
       
       
        <property name="entityInterceptor">
       <!--      <bean class="edu.northwestern.bioinformatics.studycalendar.utils.GridIdentifierInterceptor" autowire="byType">
            </bean>-->
            <ref local="chainedInterceptor"/>
        </property> 
    </bean>


    <bean id="auditSessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean" autowire="byName">
        <property name="mappingLocations">
            <list>
                <value>classpath:edu/northwestern/bioinformatics/studycalendar/domain/hibernate/typedefs.hbm.xml</value>
                <!--<value>classpath:edu/northwestern/bioinformatics/studycalendar/domain/hibernate/overrides.xml</value>-->
            </list>
        </property>
        <property name="namingStrategy">
            <bean class="edu.northwestern.bioinformatics.studycalendar.utils.hibernate.StudyCalendarNamingStrategy"/>
        </property>
        <property name="annotatedClasses">
            <list>
 				<value>gov.nih.nci.cabig.ctms.audit.domain.DataAuditEventValue</value>
                <value>gov.nih.nci.cabig.ctms.audit.domain.DataAuditEvent</value>            
          </list>
        </property>
    </bean>
	    
    <bean  id="gridIdentifierInterceptor" class="edu.northwestern.bioinformatics.studycalendar.utils.GridIdentifierInterceptor" autowire="byType"></bean>
    
	<bean id="chainedInterceptor" class="gov.nih.nci.cabig.ctms.audit.ChainedInterceptor" autowire="byType">
		<property name="interceptors">
			<list>
				<ref local="gridIdentifierInterceptor"/>
                <ref local="auditInterceptor" />
			</list>
		</property>
	</bean>

	<bean id="auditInterceptor" class="gov.nih.nci.cabig.ctms.audit.AuditInterceptorImpl" autowire="byType">
		<property name="dataAuditRepository" ref="dataAuditRepository"></property>
		<property name="auditableEntities">
			<list>
				 <value>edu.northwestern.bioinformatics.studycalendar.domain.StudySegment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Period</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Study</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Activity</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ActivityType</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.PlannedActivity</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Site</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Source</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.StudySite</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Subject</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.StudySubjectAssignment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.PlannedCalendar</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Epoch</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ScheduledCalendar</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ScheduledStudySegment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.ScheduledActivity</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Scheduled</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Occurred</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Canceled</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Conditional</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.Missed</value>
                <value>
                    edu.northwestern.bioinformatics.studycalendar.domain.scheduledactivitystate.NotApplicable
                </value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.auditing.LoginAudit</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.reporting.ReportRow</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.AdverseEvent</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.AdverseEventNotification</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.MonthDayHoliday</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.DayOfTheWeek</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.RelativeRecurringHoliday</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.User</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.UserRole</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.Population</value>

                <!-- Amendments & customizations -->
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Amendment</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Change</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Add</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Reorder</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PropertyChange</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Remove</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.Delta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PlannedCalendarDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.EpochDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.StudySegmentDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PeriodDelta</value>
                <value>edu.northwestern.bioinformatics.studycalendar.domain.delta.PlannedActivityDelta</value>
				                
			</list>
		</property>
		<property name="auditAll"><value>false</value></property>
	</bean>
        
    <bean id="gridIdentifierCreator" class="edu.northwestern.bioinformatics.studycalendar.utils.LocalGridIdentifierCreator"/>

    <bean id="openSessionInViewInterceptor" class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor" autowire="byName">
        <property name="singleSession"><value>true</value></property>
        <property name="flushModeName"><value>FLUSH_AUTO</value></property>
    </bean>

    <bean id="auditOpenSessionInViewInterceptor" class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor">
        <property name="sessionFactory"><ref local="auditSessionFactory"/></property>
        <property name="singleSession"><value>true</value></property>
        <property name="flushModeName"><value>FLUSH_AUTO</value></property>
    </bean>

    <bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager" autowire="byName"/>

    <bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
        <property name="checkWriteOperations"><value>true</value></property>
        <property name="sessionFactory"><ref bean="sessionFactory"/></property>
    </bean>

    <bean id="daoTemplate" abstract="true">
        <property name="hibernateTemplate"><ref local="hibernateTemplate"/></property>
    </bean>

    <bean id="configuration" parent="daoTemplate"
          class="edu.northwestern.bioinformatics.studycalendar.utils.configuration.Configuration"/>

    <bean id="daoFinder" class="edu.northwestern.bioinformatics.studycalendar.dao.SpringDaoFinder"/>

    <!-- ACTUAL DAOS -->
    <bean name="dataAuditRepository" class="gov.nih.nci.cabig.ctms.audit.dao.DataAuditRepository">
        <property name="sessionFactory">
            <ref local="auditSessionFactory"/>
        </property>
    </bean>

    <bean id="auditHistoryRepository" class="gov.nih.nci.cabig.ctms.audit.dao.AuditHistoryRepository">
        <property name="sessionFactory" ref="auditSessionFactory"></property>
    </bean>


    <tx:annotation-driven proxy-target-class="true"/>

    <bean id="studyDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.StudyDao"/>
    <bean id="plannedCalendarDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.PlannedCalendarDao"/>
    <bean id="epochDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.EpochDao"/>
    <bean id="studySegmentDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.StudySegmentDao"/>
    <bean id="activityDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.ActivityDao"/>
    <bean id="plannedActivityDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.PlannedActivityDao"/>
    <bean id="periodDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.PeriodDao"/>

    <bean id="siteDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.SiteDao"/>
    <bean id="subjectDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.SubjectDao"/>
    <bean id="studySubjectAssignmentDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.StudySubjectAssignmentDao"/>
    <bean id="studySiteDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.StudySiteDao"/>

    <bean id="scheduledCalendarDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.ScheduledCalendarDao"/>
    <bean id="scheduledStudySegmentDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.ScheduledStudySegmentDao"/>
    <bean id="scheduledActivityDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.ScheduledActivityDao"/>
    <bean id="adverseEventNotificationDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.AdverseEventNotificationDao"/>
    <bean id="populationDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.PopulationDao"/>

    <bean id="loginAuditDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.auditing.LoginAuditDao"/>
    <bean id="reportRowDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.reporting.ReportRowDao"/>

    <bean id="userDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.UserDao"/>
    <bean id="amendmentDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.delta.AmendmentDao"/>
    <bean id="deltaDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.delta.DeltaDao"/>
    <bean id="userRoleDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.UserRoleDao"/>
    <bean id="sourceDao" parent="daoTemplate" class="edu.northwestern.bioinformatics.studycalendar.dao.SourceDao"/>
</beans>
